<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>å£²ä¸Šãƒ»é€é‡‘ãƒ•ã‚©ãƒ¼ãƒ </title>
  <style>
    :root { --w: 375px; }
    body { margin: 0; font-family: system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif; background:#fff; }
    .wrap { max-width: var(--w); margin: 0 auto; padding: 14px 12px 24px; }
    h1 { font-size: 16px; margin: 0 0 10px; }
    .card { border: 1px solid #e5e5e5; border-radius: 12px; padding: 12px; }
    .row { display: grid; grid-template-columns: 1fr; gap: 8px; margin-bottom: 10px; }
    label { font-size: 12px; color: #333; }
    input, select, textarea, button {
      width: 100%; box-sizing: border-box; font-size: 14px;
      padding: 10px 10px; border: 1px solid #d9d9d9; border-radius: 10px;
      background: #fff;
    }
    textarea { min-height: 70px; resize: vertical; }
    .btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
    .btns.one { grid-template-columns: 1fr; }
    button { border: none; border-radius: 12px; padding: 12px 10px; font-weight: 700; cursor: pointer; }
    .primary { background: #111; color: #fff; }
    .ghost { background: #f2f2f2; color:#111; }
    .muted { color:#666; font-size:12px; }
    .secTitle { font-size: 13px; font-weight: 800; margin: 10px 0 6px; }
    .kvs { font-size: 13px; line-height: 1.35; }
    .kvs .line { display:flex; justify-content: space-between; gap: 10px; padding: 4px 0; border-bottom: 1px dashed #eee; }
    .kvs .line:last-child { border-bottom: 0; }
    .mono { font-variant-numeric: tabular-nums; }
    .hide { display:none; }
    .ok { background:#f7fff7; border:1px solid #cfe9cf; }
    .err { background:#fff7f7; border:1px solid #f0caca; }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>å£²ä¸Šãƒ»é€é‡‘ãƒ•ã‚©ãƒ¼ãƒ </h1>

    <!-- å…¥åŠ›ç”»é¢ -->
    <div id="stepInput" class="card">
      <div class="row">
        <label>æ°å</label>
        <input id="name" autocomplete="name" placeholder="ä¾‹ï¼šã—ã‚…ã‚“" required />
      </div>

      <div class="row">
        <label>å£²ä¸Šæ—¥</label>
        <input id="salesDate" type="date" required />
      </div>

      <div class="row">
        <label>ğŸº å£²ä¸Šåº—èˆ—</label>
        <select id="store" required>
          <option value="" selected>é¸æŠã—ã¦ãã ã•ã„</option>
          <option>ãƒ­ã‚«ãƒ­</option>
          <option>ã‚¤ãƒ¼ã‚¨ãƒƒã‚¯ã‚¹</option>
          <option>ãƒã‚ºãƒ«ãƒ¼ãƒ </option>
          <option>ã†ãŸã®ã»ãé“</option>
          <option>ã‚«ãƒ©ã‚ªã‚±ãƒã‚¹ã‚¿ãƒ¼</option>
        </select>
      </div>

      <div class="secTitle">ğŸ’¹ å£²ä¸Š</div>
      <div class="row">
        <label>ç¾é‡‘</label>
        <input id="salesCash" inputmode="numeric" placeholder="ä¾‹ï¼š10000" />
      </div>
      <div class="row">
        <label>å£²æ›é‡‘/ã‚¯ãƒ¬ã‚«</label>
        <input id="salesCredit" inputmode="numeric" placeholder="ä¾‹ï¼š8000" />
      </div>
      <div class="row">
        <label>å£²æ›é‡‘/QR</label>
        <input id="salesQR" inputmode="numeric" placeholder="ä¾‹ï¼š2000" />
      </div>

      <div class="secTitle">ğŸ‘› çµŒè²»</div>
      <div class="row">
        <label>ç¾é‡‘</label>
        <input id="expCash" inputmode="numeric" placeholder="ä¾‹ï¼š1200" />
      </div>
      <div class="row">
        <label>UPSIDERã‚«ãƒ¼ãƒ‰</label>
        <input id="expUpsider" inputmode="numeric" placeholder="ä¾‹ï¼š3000" />
      </div>
      <div class="row">
        <label>ä¸‰äº•ä½å‹ã‚«ãƒ¼ãƒ‰</label>
        <input id="expSMBC" inputmode="numeric" placeholder="ä¾‹ï¼š0" />
      </div>

      <div class="secTitle">ğŸ¦ é€é‡‘</div>
      <div class="row">
        <label>é€é‡‘é¡</label>
        <input id="transferAmount" inputmode="numeric" placeholder="ä¾‹ï¼š15800" />
      </div>
      <div class="row">
        <label>é€é‡‘æ—¥</label>
        <input id="transferDate" type="date" />
      </div>
      <div class="row">
        <label>é€é‡‘å…ˆ</label>
        <input id="transferTo" placeholder="ä¾‹ï¼šGMOã‚ãŠãã‚‰" />
      </div>
      <div class="row">
        <label>é€é‡‘ç”³è«‹é¡ï¼ˆä¸è¶³é‡‘ãŒç™ºç”Ÿã—ãŸå ´åˆï¼‰</label>
        <input id="shortageRequest" inputmode="numeric" placeholder="ä¾‹ï¼š2000ï¼ˆãªã‘ã‚Œã°ç©ºæ¬„ï¼‰" />
      </div>

      <div class="row">
        <label>å‚™è€ƒæ¬„</label>
        <textarea id="note" placeholder="ä¾‹ï¼šæ°·ä»£ã‚’çµŒè²»ã§ç²¾ç®—"></textarea>
      </div>

      <p class="muted">â€» é€ä¿¡å‰ã«ç¢ºèªç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼ˆã‚¹ã‚¯ã‚·ãƒ§1æšæƒ³å®šï¼‰</p>
      <div class="btns one">
        <button class="primary" id="toConfirm">ç¢ºèªç”»é¢ã¸</button>
      </div>

      <div id="inputMsg" class="hide"></div>
    </div>

    <!-- ç¢ºèªç”»é¢ -->
    <div id="stepConfirm" class="card hide">
      <div class="secTitle">ã€ç¢ºèªã€‘</div>
      <div class="kvs">
        <div class="line"><span>æ°å</span><span class="mono" id="c_name"></span></div>
        <div class="line"><span>å£²ä¸Šæ—¥</span><span class="mono" id="c_salesDate"></span></div>
        <div class="line"><span>åº—èˆ—</span><span id="c_store"></span></div>
      </div>

      <div class="secTitle">ğŸ’¹ å£²ä¸Š</div>
      <div class="kvs">
        <div class="line"><span>ç¾é‡‘</span><span class="mono" id="c_salesCash"></span></div>
        <div class="line"><span>ã‚¯ãƒ¬ã‚«</span><span class="mono" id="c_salesCredit"></span></div>
        <div class="line"><span>QR</span><span class="mono" id="c_salesQR"></span></div>
      </div>

      <div class="secTitle">ğŸ‘› çµŒè²»</div>
      <div class="kvs">
        <div class="line"><span>ç¾é‡‘</span><span class="mono" id="c_expCash"></span></div>
        <div class="line"><span>UPSIDER</span><span class="mono" id="c_expUpsider"></span></div>
        <div class="line"><span>ä¸‰äº•ä½å‹</span><span class="mono" id="c_expSMBC"></span></div>
      </div>

      <div class="secTitle">ğŸ¦ é€é‡‘</div>
      <div class="kvs">
        <div class="line"><span>é€é‡‘é¡</span><span class="mono" id="c_transferAmount"></span></div>
        <div class="line"><span>é€é‡‘æ—¥</span><span class="mono" id="c_transferDate"></span></div>
        <div class="line"><span>é€é‡‘å…ˆ</span><span id="c_transferTo"></span></div>
        <div class="line" id="c_shortageRow"><span>ä¸è¶³é‡‘ç”³è«‹</span><span class="mono" id="c_shortageRequest"></span></div>
      </div>

      <div class="secTitle">å‚™è€ƒ</div>
      <div class="kvs">
        <div class="line"><span style="white-space:nowrap;">å‚™è€ƒ</span><span id="c_note" style="text-align:right; overflow:hidden; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;"></span></div>
      </div>

      <div class="btns">
        <button class="ghost" id="backToEdit">ä¿®æ­£ã™ã‚‹</button>
        <button class="primary" id="submitBtn">é€ä¿¡ã™ã‚‹</button>
      </div>

      <div id="confirmMsg" class="hide"></div>
    </div>
  </div>

<script>
  // ========= è¨­å®š =========
  // GAS Web App ã®URLï¼ˆå¾Œã§å·®ã—æ›¿ãˆï¼‰
  const API_URL = "PASTE_YOUR_GAS_WEBAPP_URL_HERE";
  // ç°¡æ˜“ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆGASå´ã¨åˆã‚ã›ã‚‹ã€‚å…¬é–‹ãƒ•ã‚©ãƒ¼ãƒ å¯¾ç­–ã®æœ€ä½é™ï¼‰
  const API_TOKEN = "CHANGE_ME_TOKEN";

  // ========= ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ =========
  const yen = (n) => "Â¥" + (Number(n||0)).toLocaleString("ja-JP");
  const toNum = (v) => {
    if (v == null) return 0;
    const s = String(v).replace(/[^\d\-]/g, "");
    if (s === "" || s === "-") return 0;
    return Number(s);
  };
  const fmtDate = (v) => v ? v : "";

  const el = (id) => document.getElementById(id);

  function showMsg(target, ok, text){
    target.className = ok ? "card ok" : "card err";
    target.style.marginTop = "10px";
    target.innerText = text;
    target.classList.remove("hide");
  }

  function hideMsg(target){
    target.classList.add("hide");
    target.innerText = "";
  }

  function collect(){
    const data = {
      name: el("name").value.trim(),
      salesDate: el("salesDate").value,
      store: el("store").value,

      salesCash: toNum(el("salesCash").value),
      salesCredit: toNum(el("salesCredit").value),
      salesQR: toNum(el("salesQR").value),

      expCash: toNum(el("expCash").value),
      expUpsider: toNum(el("expUpsider").value),
      expSMBC: toNum(el("expSMBC").value),

      transferAmount: toNum(el("transferAmount").value),
      transferDate: el("transferDate").value,
      transferTo: el("transferTo").value.trim(),
      shortageRequest: toNum(el("shortageRequest").value),

      note: el("note").value.trim()
    };

    // æœ¬ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼šGASå´ã§ä»˜ä¸ï¼ˆã‚µãƒ¼ãƒæ™‚åˆ»ï¼‰
    return data;
  }

  function validate(d){
    if (!d.name) return "æ°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„";
    if (!d.salesDate) return "å£²ä¸Šæ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„";
    if (!d.store) return "å£²ä¸Šåº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„";
    // æ•°å­—ã¯0è¨±å®¹ï¼ˆç©ºæ¬„=0ï¼‰ã§OKã«ã—ã¦ãŠã
    return null;
  }

  function fillConfirm(d){
    el("c_name").innerText = d.name;
    el("c_salesDate").innerText = fmtDate(d.salesDate);
    el("c_store").innerText = d.store;

    el("c_salesCash").innerText = yen(d.salesCash);
    el("c_salesCredit").innerText = yen(d.salesCredit);
    el("c_salesQR").innerText = yen(d.salesQR);

    el("c_expCash").innerText = yen(d.expCash);
    el("c_expUpsider").innerText = yen(d.expUpsider);
    el("c_expSMBC").innerText = yen(d.expSMBC);

    el("c_transferAmount").innerText = yen(d.transferAmount);
    el("c_transferDate").innerText = fmtDate(d.transferDate);
    el("c_transferTo").innerText = d.transferTo || "â€”";

    if (d.shortageRequest && d.shortageRequest !== 0){
      el("c_shortageRow").style.display = "flex";
      el("c_shortageRequest").innerText = yen(d.shortageRequest);
    } else {
      el("c_shortageRow").style.display = "none";
      el("c_shortageRequest").innerText = "";
    }

    el("c_note").innerText = d.note || "â€”";
  }

  function gotoConfirm(){
    const d = collect();
    const err = validate(d);
    const msg = el("inputMsg");
    hideMsg(msg);
    if (err){
      showMsg(msg, false, err);
      return;
    }
    fillConfirm(d);
    el("stepInput").classList.add("hide");
    el("stepConfirm").classList.remove("hide");
  }

  function backToEdit(){
    hideMsg(el("confirmMsg"));
    el("stepConfirm").classList.add("hide");
    el("stepInput").classList.remove("hide");
  }

  async function submit(){
    const d = collect();
    const err = validate(d);
    const msg = el("confirmMsg");
    hideMsg(msg);
    if (err){
      showMsg(msg, false, err);
      return;
    }
    if (!API_URL || API_URL.includes("PASTE_YOUR_GAS_WEBAPP_URL_HERE")){
      showMsg(msg, false, "API_URL ãŒæœªè¨­å®šã§ã™ï¼ˆGAS Web App URL ã‚’è²¼ã£ã¦ãã ã•ã„ï¼‰");
      return;
    }

    el("submitBtn").disabled = true;
    el("submitBtn").innerText = "é€ä¿¡ä¸­â€¦";

    try {
      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token: API_TOKEN, data: d })
      });
      const json = await res.json().catch(()=> ({}));
      if (!res.ok || json.ok !== true){
        throw new Error(json.error || "é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ");
      }
      showMsg(msg, true, "é€ä¿¡å®Œäº†ã—ã¾ã—ãŸã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚");
      // é€£æŠ•é˜²æ­¢ï¼šå…¥åŠ›ç”»é¢ã‚’ã‚¯ãƒªã‚¢ã—ãŸã„å ´åˆã¯ã“ã“ã§ reset
      // location.reload();
    } catch(e){
      showMsg(msg, false, "ã‚¨ãƒ©ãƒ¼ï¼š " + e.message);
    } finally {
      el("submitBtn").disabled = false;
      el("submitBtn").innerText = "é€ä¿¡ã™ã‚‹";
    }
  }

  el("toConfirm").addEventListener("click", (e)=>{ e.preventDefault(); gotoConfirm(); });
  el("backToEdit").addEventListener("click", (e)=>{ e.preventDefault(); backToEdit(); });
  el("submitBtn").addEventListener("click", (e)=>{ e.preventDefault(); submit(); });
</script>
</body>
</html>
